[('.classpath',
  '.classpath',
  'Index: .classpath\n===================================================================\n--- .classpath\n+++ .classpath\n@@ -0,0 +1,48 @@\n+<?xml version="1.0" encoding="UTF-8"?>\n+<classpath>\n+\t<classpathentry kind="src" path="main/plugin-explorer/src"/>\n+\t<classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/JavaSE-1.6"/>\n+\t<classpathentry kind="con" path="org.apache.ivyde.eclipse.cpcontainer.IVYDE_CONTAINER/?ivyXmlPath=ivy.xml&amp;confs=*"/>\n+\t<classpathentry kind="lib" path="C:/Documents and Settings/celad/Mes documents/dependances/antlr3-maven-plugin-3.1.3-1.jar"/>\n+\t<classpathentry kind="lib" path="C:/Documents and Settings/celad/Mes documents/dependances/antlr-3.1.3.jar"/>\n+\t<classpathentry kind="lib" path="C:/Documents and Settings/celad/Mes documents/dependances/antlr-runtime-3.1.3.jar"/>\n+\t<classpathentry kind="lib" path="C:/Documents and Settings/celad/Mes documents/dependances/aopalliance-1.0.jar"/>\n+\t<classpathentry kind="lib" path="C:/Documents and Settings/celad/Mes documents/dependances/asm-3.0.jar"/>\n+\t<classpathentry kind="lib" path="C:/Documents and Settings/celad/Mes documents/dependances/aspectjrt-1.5.3.jar"/>\n+\t<classpathentry kind="lib" path="C:/Documents and Settings/celad/Mes documents/dependances/commons-beanutils-1.7.0.jar"/>\n+\t<classpathentry kind="lib" path="C:/Documents and Settings/celad/Mes documents/dependances/commons-codec-1.3.jar"/>\n+\t<classpathentry kind="lib" path="C:/Documents and Settings/celad/Mes documents/dependances/commons-collections-3.2.jar"/>\n+\t<classpathentry kind="lib" path="C:/Documents and Settings/celad/Mes documents/dependances/commons-digester-1.6.jar"/>\n+\t<classpathentry kind="lib" path="C:/Documents and Settings/celad/Mes documents/dependances/commons-httpclient-3.1.jar"/>\n+\t<classpathentry kind="lib" path="C:/Documents and Settings/celad/Mes documents/dependances/commons-io-1.4.jar"/>\n+\t<classpathentry kind="lib" path="C:/Documents and Settings/celad/Mes documents/dependances/commons-lang-2.4.jar"/>\n+\t<classpathentry kind="lib" path="C:/Documents and Settings/celad/Mes documents/dependances/commons-logging-1.1.1.jar"/>\n+\t<classpathentry kind="lib" path="C:/Documents and Settings/celad/Mes documents/dependances/commons-logging-api-1.1.jar"/>\n+\t<classpathentry kind="lib" path="C:/Documents and Settings/celad/Mes documents/dependances/commons-validator-1.2.0.jar"/>\n+\t<classpathentry kind="lib" path="C:/Documents and Settings/celad/Mes documents/dependances/concurrent-1.3.4.jar"/>\n+\t<classpathentry kind="lib" path="C:/Documents and Settings/celad/Mes documents/dependances/FastInfoset-1.2.3.jar"/>\n+\t<classpathentry kind="lib" path="C:/Documents and Settings/celad/Mes documents/dependances/gunit-3.1.3.jar"/>\n+\t<classpathentry kind="lib" path="C:/Documents and Settings/celad/Mes documents/dependances/htmlparser-1.0.5.jar"/>\n+\t<classpathentry kind="lib" path="C:/Documents and Settings/celad/Mes documents/dependances/jaxb-api-2.1.jar"/>\n+\t<classpathentry kind="lib" path="C:/Documents and Settings/celad/Mes documents/dependances/jaxb-impl-2.1.9.jar"/>\n+\t<classpathentry kind="lib" path="C:/Documents and Settings/celad/Mes documents/dependances/jaxen-1.1.1.jar"/>\n+\t<classpathentry kind="lib" path="C:/Documents and Settings/celad/Mes documents/dependances/jcr-1.0.jar"/>\n+\t<classpathentry kind="lib" path="C:/Documents and Settings/celad/Mes documents/dependances/jline-0.9.94.jar"/>\n+\t<classpathentry kind="lib" path="C:/Documents and Settings/celad/Mes documents/dependances/jsr311-api-1.0.jar"/>\n+\t<classpathentry kind="lib" path="C:/Documents and Settings/celad/Mes documents/dependances/junit-4.7.jar"/>\n+\t<classpathentry kind="lib" path="C:/Documents and Settings/celad/Mes documents/dependances/log4j-1.2.15.jar"/>\n+\t<classpathentry kind="lib" path="C:/Documents and Settings/celad/Mes documents/dependances/maven-gunit-plugin-3.1.3.jar"/>\n+\t<classpathentry kind="lib" path="C:/Documents and Settings/celad/Mes documents/dependances/nekohtml-1.9.7.jar"/>\n+\t<classpathentry kind="lib" path="C:/Documents and Settings/celad/Mes documents/dependances/servlet-api-2.4.jar"/>\n+\t<classpathentry kind="lib" path="C:/Documents and Settings/celad/Mes documents/dependances/stax-api-1.0.1.jar"/>\n+\t<classpathentry kind="lib" path="C:/Documents and Settings/celad/Mes documents/dependances/stringtemplate-3.2.jar"/>\n+\t<classpathentry kind="lib" path="C:/Documents and Settings/celad/Mes documents/dependances/wsdl4j-1.6.2.jar"/>\n+\t<classpathentry kind="lib" path="C:/Documents and Settings/celad/Mes documents/dependances/xercesImpl-2.9.1.jar"/>\n+\t<classpathentry kind="lib" path="C:/Documents and Settings/celad/Mes documents/dependances/xml-apis-1.3.04.jar"/>\n+\t<classpathentry kind="lib" path="C:/Documents and Settings/mmartin/Mes documents/jar_chemistry/chemistry-api-0.5-SNAPSHOT.jar"/>\n+\t<classpathentry kind="lib" path="C:/Documents and Settings/mmartin/Mes documents/jar_chemistry/chemistry-atompub-0.5-SNAPSHOT.jar"/>\n+\t<classpathentry kind="lib" path="C:/Documents and Settings/mmartin/Mes documents/jar_chemistry/chemistry-atompub-client-0.5-SNAPSHOT.jar"/>\n+\t<classpathentry kind="lib" path="C:/Documents and Settings/mmartin/Mes documents/jar_chemistry/chemistry-commons-0.5-SNAPSHOT.jar"/>\n+\t<classpathentry kind="lib" path="C:/Documents and Settings/mmartin/Mes documents/jar_chemistry/chemistry-shell-0.5-SNAPSHOT.jar"/>\n+\t<classpathentry kind="output" path="bin"/>\n+</classpath>'),
 ('.project',
  '.project',
  'Index: .project\n===================================================================\n--- .project\n+++ .project\n@@ -0,0 +1,23 @@\n+<?xml version="1.0" encoding="UTF-8"?>\n+<projectDescription>\n+\t<name>plugin explorer</name>\n+\t<comment></comment>\n+\t<projects>\n+\t</projects>\n+\t<buildSpec>\n+\t\t<buildCommand>\n+\t\t\t<name>org.eclipse.jdt.core.javabuilder</name>\n+\t\t\t<arguments>\n+\t\t\t</arguments>\n+\t\t</buildCommand>\n+\t\t<buildCommand>\n+\t\t\t<name>com.atlassw.tools.eclipse.checkstyle.CheckstyleBuilder</name>\n+\t\t\t<arguments>\n+\t\t\t</arguments>\n+\t\t</buildCommand>\n+\t</buildSpec>\n+\t<natures>\n+\t\t<nature>org.eclipse.jdt.core.javanature</nature>\n+\t\t<nature>com.atlassw.tools.eclipse.checkstyle.CheckstyleNature</nature>\n+\t</natures>\n+</projectDescription>'),
 ('.settings/org.eclipse.jdt.core.prefs',
  '.settings/org.eclipse.jdt.core.prefs',
  'Index: .settings/org.eclipse.jdt.core.prefs\n===================================================================\n--- .settings/org.eclipse.jdt.core.prefs\n+++ .settings/org.eclipse.jdt.core.prefs\n@@ -0,0 +1,12 @@\n+#Tue Mar 02 11:21:55 CET 2010\n+eclipse.preferences.version=1\n+org.eclipse.jdt.core.compiler.codegen.inlineJsrBytecode=enabled\n+org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.6\n+org.eclipse.jdt.core.compiler.codegen.unusedLocal=preserve\n+org.eclipse.jdt.core.compiler.compliance=1.6\n+org.eclipse.jdt.core.compiler.debug.lineNumber=generate\n+org.eclipse.jdt.core.compiler.debug.localVariable=generate\n+org.eclipse.jdt.core.compiler.debug.sourceFile=generate\n+org.eclipse.jdt.core.compiler.problem.assertIdentifier=error\n+org.eclipse.jdt.core.compiler.problem.enumIdentifier=error\n+org.eclipse.jdt.core.compiler.source=1.6'),
 ('.checkstyle',
  '.checkstyle',
  'Index: .checkstyle\n===================================================================\n--- .checkstyle\n+++ .checkstyle\n@@ -0,0 +1,9 @@\n+<?xml version="1.0" encoding="UTF-8"?>\n+<fileset-config file-format-version="1.2.0" simple-config="true">\n+    <local-check-config name="any-content" location="C:\\Documents and Settings\\mmartin\\Mes documents\\eclipse\\configuration\\AnyContent checkstyle.xml" type="external" description="">\n+        <additional-data name="protect-config-file" value="false"/>\n+    </local-check-config>\n+    <fileset name="tous" enabled="true" check-config-name="any-content" local="true">\n+        <file-match-pattern match-pattern="." include-pattern="true"/>\n+    </fileset>\n+</fileset-config>'),
 ('main/plugin-explorer/sitemap.xmap',
  'main/plugin-explorer/sitemap.xmap',
  'Index: main/plugin-explorer/sitemap.xmap\n===================================================================\n--- main/plugin-explorer/sitemap.xmap\n+++ main/plugin-explorer/sitemap.xmap\n@@ -19,6 +19,7 @@\n<map:components>\n\n<map:actions>\n+\t\t\t<map:action name="add-cmis-collection" src="org.ametys.plugins.explorer.resources.actions.AddCMISCollectionAction" logger="org.ametys.explorer.actions" />\n<map:action name="add-collection" src="org.ametys.plugins.explorer.resources.actions.AddCollectionAction" logger="org.ametys.explorer.actions" />\n<map:action name="move-object" src="org.ametys.plugins.explorer.resources.actions.MoveObjectAction" logger="org.ametys.explorer.actions"/>\n<map:action name="rename-object" src="org.ametys.plugins.explorer.resources.actions.RenameObjectAction" logger="org.ametys.explorer.actions"/>\n@@ -91,6 +92,17 @@\n</map:act>\n</map:match>\n\n+\t\t\t<map:match pattern="add-cmis-collection">\n+\t\t\t\t<map:act type="add-cmis-collection">\n+\t\t\t\t\t<map:generate type="action-result">\n+\t\t\t\t\t\t<map:parameter name="id" value="{id}"/>\n+\t\t\t\t\t\t<map:parameter name="parentID" value="{parentID}"/>\n+\t\t\t\t\t\t<map:parameter name="name" value="{name}"/>\n+\t\t\t\t\t</map:generate>\n+\t\t\t\t\t<map:serialize type="xml" />\n+\t\t\t\t</map:act>\n+\t\t\t</map:match>\n+\n<map:match pattern="move-object">\n<map:act type="move-object">\n<map:generate type="action-result">'),
 ('main/plugin-explorer/i18n/messages_fr.xml',
  'main/plugin-explorer/i18n/messages_fr.xml',
  'Index: main/plugin-explorer/i18n/messages_fr.xml\n===================================================================\n--- main/plugin-explorer/i18n/messages_fr.xml\n+++ main/plugin-explorer/i18n/messages_fr.xml\n@@ -92,6 +92,13 @@\n<message key="PLUGINS_EXPLORER_VIEW_DETAILS_DESCRIPTION">Passe en mode de vue d\xc3\xa9taill\xc3\xa9e</message>\n\n<!-- Actions -->\n+\t<message key="PLUGINS_EXPLORER_FOLDER_ADD_CMIS_REP_TITLE">Ajout des identifiants de connexion</message>\n+\t<message key="PLUGINS_EXPLORER_FOLDER_ADD_CMIS_REP_URL">URL</message>\n+\t<message key="PLUGINS_EXPLORER_FOLDER_ADD_CMIS_REP_USER">Nom utilisateur</message>\n+\t<message key="PLUGINS_EXPLORER_FOLDER_ADD_CMIS_REP_PWD">Mot de passe</message>\n+\t<message key="PLUGINS_EXPLORER_FOLDER_ADD_CMIS_REP_ERROR_TITLE">Param\xc3\xa8tres manquants</message>\n+\t<message key="PLUGINS_EXPLORER_FOLDER_ADD_CMIS_REP_ERROR_MESSAGE">Merci de renseigner tous les champs.</message>\n+\n<message key="PLUGINS_EXPLORER_FOLDER_HANDLE_ADD">Nouveau dossier</message>\n<message key="PLUGINS_EXPLORER_FOLDER_HANDLE_ADD_NEWNAME">Nouveau dossier</message>\n<message key="PLUGINS_EXPLORER_FOLDER_NAME">Nom</message>'),
 ('main/plugin-explorer/i18n/messages_en.xml',
  'main/plugin-explorer/i18n/messages_en.xml',
  'Index: main/plugin-explorer/i18n/messages_en.xml\n===================================================================\n--- main/plugin-explorer/i18n/messages_en.xml\n+++ main/plugin-explorer/i18n/messages_en.xml\n@@ -92,6 +92,14 @@\n<message key="PLUGINS_EXPLORER_VIEW_DETAILS_DESCRIPTION">Switchs to detailed view</message>\n\n<!-- Actions -->\n+\t<message key="PLUGINS_EXPLORER_FOLDER_ADD_CMIS_REP_TITLE">Add the connection IDs</message>\n+\t<message key="PLUGINS_EXPLORER_FOLDER_ADD_CMIS_REP_URL">URL</message>\n+\t<message key="PLUGINS_EXPLORER_FOLDER_ADD_CMIS_REP_USER">User</message>\n+\t<message key="PLUGINS_EXPLORER_FOLDER_ADD_CMIS_REP_PWD">Password</message>\n+\t<message key="PLUGINS_EXPLORER_FOLDER_ADD_CMIS_REP_ERROR_TITLE">Missing Parameters</message>\n+\t<message key="PLUGINS_EXPLORER_FOLDER_ADD_CMIS_REP_ERROR_MESSAGE">Please fill in all fields</message>\n+\n+\n<message key="PLUGINS_EXPLORER_FOLDER_HANDLE_ADD">New folder</message>\n<message key="PLUGINS_EXPLORER_FOLDER_HANDLE_ADD_NEWNAME">New folder</message>\n<message key="PLUGINS_EXPLORER_FOLDER_NAME">Name</message>'),
 ('main/plugin-explorer/src/org/ametys/plugins/explorer/resources/generators/ResourcesExplorerGenerator.java',
  'main/plugin-explorer/src/org/ametys/plugins/explorer/resources/generators/ResourcesExplorerGenerator.java',
  'Index: main/plugin-explorer/src/org/ametys/plugins/explorer/resources/generators/ResourcesExplorerGenerator.java\n===================================================================\n--- main/plugin-explorer/src/org/ametys/plugins/explorer/resources/generators/ResourcesExplorerGenerator.java\n+++ main/plugin-explorer/src/org/ametys/plugins/explorer/resources/generators/ResourcesExplorerGenerator.java\n@@ -28,10 +28,12 @@\nimport org.xml.sax.SAXException;\n\nimport org.ametys.plugins.explorer.ExplorerNode;\n+import org.ametys.plugins.explorer.resources.ModifiableResource;\nimport org.ametys.plugins.explorer.resources.Resource;\nimport org.ametys.plugins.repository.AmetysObject;\nimport org.ametys.plugins.repository.AmetysObjectIterable;\nimport org.ametys.plugins.repository.AmetysObjectResolver;\n+import org.ametys.plugins.repository.ModifiableAmetysObject;\nimport org.ametys.plugins.repository.TraversableAmetysObject;\nimport org.ametys.runtime.user.User;\nimport org.ametys.runtime.user.UsersManager;\n@@ -111,6 +113,16 @@\nchildAtts.addCDATAAttribute("name", node.getName());\nchildAtts.addCDATAAttribute("icon", node.getIcon());\nchildAtts.addCDATAAttribute("applicationId", node.getApplicationId());\n+\n+        if (node instanceof ModifiableAmetysObject)\n+        {\n+            childAtts.addCDATAAttribute("isModifiable", "true");\n+        }\n+        else\n+        {\n+            childAtts.addCDATAAttribute("isModifiable", "false");\n+        }\n+\n\nboolean hasChildNodes = false;\nboolean hasResources = false;\n@@ -158,6 +170,16 @@\nchildAtts.addCDATAAttribute("size", String.valueOf(resource.getLength()));\nchildAtts.addCDATAAttribute("author", name);\nchildAtts.addCDATAAttribute("keywords", resource.getKeywordsAsString());\n+\n+        if (resource instanceof ModifiableResource)\n+        {\n+            childAtts.addCDATAAttribute("isModifiable", "true");\n+        }\n+        else\n+        {\n+            childAtts.addCDATAAttribute("isModifiable", "false");\n+        }\n+\nXMLUtils.createElement(contentHandler, "Node", childAtts);\n}\n}'),
 ('main/plugin-explorer/src/org/ametys/plugins/explorer/resources/actions/AddCMISCollectionAction.java',
  'main/plugin-explorer/src/org/ametys/plugins/explorer/resources/actions/AddCMISCollectionAction.java',
  'Index: main/plugin-explorer/src/org/ametys/plugins/explorer/resources/actions/AddCMISCollectionAction.java\n===================================================================\n--- main/plugin-explorer/src/org/ametys/plugins/explorer/resources/actions/AddCMISCollectionAction.java\n+++ main/plugin-explorer/src/org/ametys/plugins/explorer/resources/actions/AddCMISCollectionAction.java\n@@ -0,0 +1,106 @@\n+package org.ametys.plugins.explorer.resources.actions;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import org.apache.avalon.framework.parameters.Parameters;\n+import org.apache.avalon.framework.service.ServiceException;\n+import org.apache.avalon.framework.service.ServiceManager;\n+import org.apache.cocoon.acting.ServiceableAction;\n+import org.apache.cocoon.environment.ObjectModelHelper;\n+import org.apache.cocoon.environment.Redirector;\n+import org.apache.cocoon.environment.Request;\n+import org.apache.cocoon.environment.SourceResolver;\n+import org.apache.commons.lang.IllegalClassException;\n+import org.apache.jackrabbit.util.Text;\n+\n+import org.ametys.plugins.explorer.cmis.CMISRootResourcesCollection;\n+import org.ametys.plugins.explorer.cmis.CMISTreeFactory;\n+import org.ametys.plugins.explorer.observation.ExplorerEvent;\n+import org.ametys.plugins.explorer.observation.ExplorerObservationManager;\n+import org.ametys.plugins.explorer.observation.ExplorerEvent.EventType;\n+import org.ametys.plugins.repository.AmetysObject;\n+import org.ametys.plugins.repository.AmetysObjectResolver;\n+import org.ametys.plugins.repository.ModifiableTraversableAmetysObject;\n+import org.ametys.runtime.user.CurrentUserProvider;\n+\n+/**\n+ * Action for adding a CMIS resource collection.\n+ *\n+ */\n+public class AddCMISCollectionAction extends ServiceableAction\n+{\n+    private AmetysObjectResolver _resolver;\n+    private CurrentUserProvider _userProvider;\n+    private ExplorerObservationManager _obsManager;\n+\n+    @Override\n+    public void service(ServiceManager sManager) throws ServiceException\n+    {\n+        super.service(sManager);\n+\n+        _resolver = (AmetysObjectResolver) sManager.lookup(AmetysObjectResolver.ROLE);\n+        _userProvider = (CurrentUserProvider) sManager.lookup(CurrentUserProvider.ROLE);\n+        _obsManager = (ExplorerObservationManager) sManager.lookup(ExplorerObservationManager.ROLE);\n+    }\n+\n+    @Override\n+    public Map act(Redirector redirector, SourceResolver resolver, Map objectModel, String source, Parameters parameters) throws Exception\n+    {\n+        Request request = ObjectModelHelper.getRequest(objectModel);\n+        Map<String, String> result = new HashMap<String, String>();\n+\n+        String id = request.getParameter("id");\n+        String originalName = request.getParameter("name");\n+\n+        String url = request.getParameter("url");\n+        String user = request.getParameter("user");\n+        String password = request.getParameter("pwd");\n+\n+        boolean renameIfExists = request.getParameter("renameIfExists") == null ? false : Boolean.valueOf(request.getParameter("renameIfExists"));\n+        assert id != null;\n+\n+        String legalName = Text.escapeIllegalJcrChars(originalName);\n+\n+        AmetysObject object = _resolver.resolveById(id);\n+        if (!(object instanceof ModifiableTraversableAmetysObject))\n+        {\n+            throw new IllegalClassException(ModifiableTraversableAmetysObject.class, object.getClass());\n+        }\n+\n+        ModifiableTraversableAmetysObject collection = (ModifiableTraversableAmetysObject) object;\n+        if (!renameIfExists && collection.hasChild(legalName))\n+        {\n+            getLogger().warn("The object \'" + object.getName() + "\' can not be renamed in \'" + originalName + "\' : a object of same name already exists.");\n+            result.put("message", "already-exist");\n+            return result;\n+        }\n+\n+        int index = 1;\n+        while (collection.hasChild(legalName))\n+        {\n+            legalName = Text.escapeIllegalJcrChars(originalName + " (" + index + ")");\n+            index++;\n+        }\n+\n+        CMISRootResourcesCollection child = collection.createChild(legalName, CMISTreeFactory.RESOURCESCOLLECTION_NODETYPE);\n+        child.setCMISURL(url);\n+        child.setUser(user);\n+        child.setPassword(password);\n+        child.saveChanges();\n+\n+        result.put("id", child.getId());\n+        result.put("parentID", id);\n+        result.put("name", legalName);\n+\n+        // Notify listeners\n+        Map<String, Object> eventParams = new HashMap<String, Object>();\n+        eventParams.put("parentID", object.getId());\n+        eventParams.put("name", child.getName());\n+        eventParams.put("path", child.getPath());\n+        _obsManager.notifyEvent(new ExplorerEvent (EventType.COLLECTION_CREATE, _userProvider.getUser(), child.getId(), eventParams));\n+\n+        return result;\n+    }\n+\n+}'),
 ('main/plugin-explorer/src/org/ametys/plugins/explorer/ExplorerNodeGenerator.java',
  'main/plugin-explorer/src/org/ametys/plugins/explorer/ExplorerNodeGenerator.java',
  'Index: main/plugin-explorer/src/org/ametys/plugins/explorer/ExplorerNodeGenerator.java\n===================================================================\n--- main/plugin-explorer/src/org/ametys/plugins/explorer/ExplorerNodeGenerator.java\n+++ main/plugin-explorer/src/org/ametys/plugins/explorer/ExplorerNodeGenerator.java\n@@ -27,6 +27,7 @@\nimport org.ametys.plugins.explorer.resources.generators.ResourcesExplorerGenerator;\nimport org.ametys.plugins.repository.AmetysObject;\nimport org.ametys.plugins.repository.AmetysObjectIterable;\n+import org.ametys.plugins.repository.ModifiableAmetysObject;\nimport org.ametys.plugins.repository.TraversableAmetysObject;\n\n/**\n@@ -86,6 +87,16 @@\nchildAtts.addCDATAAttribute("icon", node.getIcon());\nchildAtts.addCDATAAttribute("applicationId", node.getApplicationId());\n\n+        if (node instanceof ModifiableAmetysObject)\n+        {\n+            childAtts.addCDATAAttribute("isModifiable", "true");\n+        }\n+        else\n+        {\n+            childAtts.addCDATAAttribute("isModifiable", "false");\n+        }\n+\n+\nboolean hasChild = false;\n\nfor (AmetysObject child : ((TraversableAmetysObject) node).getChildren())'),
 ('main/plugin-explorer/plugin.xml',
  'main/plugin-explorer/plugin.xml',
  'Index: main/plugin-explorer/plugin.xml\n===================================================================\n--- main/plugin-explorer/plugin.xml\n+++ main/plugin-explorer/plugin.xml\n@@ -51,6 +51,15 @@\n<scheme>resource</scheme>\n<nodetype>ametys:resource</nodetype>\n</extension>\n+\n+            <extension point="org.ametys.plugins.repository.AmetysObjectFactoryExtensionPoint"\n+\t\t\t           id="org.ametys.plugins.explorer.cmis.CMISTreeFactory"\n+\t\t\t           class="org.ametys.plugins.explorer.cmis.CMISTreeFactory">\n+                <scheme>cmis-root-collection</scheme>\n+                <nodetype>ametys:cmis-root-collection</nodetype>\n+                <nodetype-definition>resources_nodetypes.xml</nodetype-definition>\n+            </extension>\n+\n</extensions>\n</feature>\n'),
 ('main/plugin-explorer/resources/js/org/ametys/explorer/ResourcesExplorer.i18n.js',
  'main/plugin-explorer/resources/js/org/ametys/explorer/ResourcesExplorer.i18n.js',
  "Index: main/plugin-explorer/resources/js/org/ametys/explorer/ResourcesExplorer.i18n.js\n===================================================================\n--- main/plugin-explorer/resources/js/org/ametys/explorer/ResourcesExplorer.i18n.js\n+++ main/plugin-explorer/resources/js/org/ametys/explorer/ResourcesExplorer.i18n.js\n@@ -554,7 +554,7 @@\nvar appId = node.attributes.applicationId;\nif (this._applications[appId])\n{\n-\t\t\tthis._applications[appId].execCommand ('updateToolbar', {'id': node.id});\n+\t\t\tthis._applications[appId].execCommand ('updateToolbar', {'id': node.id, 'isModifiable': node.attributes['isModifiable']});\n}\n}\n}\n@@ -607,7 +607,7 @@\nvar appId = node.attributes.applicationId;\nif (this._applications[appId])\n{\n-\t\t\tthis._applications[appId].execCommand ('updateToolbar', {'id': node.id, 'files': records});\n+\t\t\tthis._applications[appId].execCommand ('updateToolbar', {'id': node.id, 'files': records, 'isModifiable': node.attributes['isModifiable']});\n}\n}\n}"),
 ('main/plugin-explorer/resources/js/org/ametys/explorer/applications/resources/ResourcesActions.i18n.js',
  'main/plugin-explorer/resources/js/org/ametys/explorer/applications/resources/ResourcesActions.i18n.js',
  'Index: main/plugin-explorer/resources/js/org/ametys/explorer/applications/resources/ResourcesActions.i18n.js\n===================================================================\n--- main/plugin-explorer/resources/js/org/ametys/explorer/applications/resources/ResourcesActions.i18n.js\n+++ main/plugin-explorer/resources/js/org/ametys/explorer/applications/resources/ResourcesActions.i18n.js\n@@ -15,6 +15,7 @@\n*/\n\nExt.namespace(\'org.ametys.explorer.applications.resources\');\n+Ext.namespace(\'org.ametys.explorer.applications.resources.Folder.addCMIS\');\nExt.namespace(\'org.ametys.explorer.applications.resources.Folder.add\');\nExt.namespace(\'org.ametys.explorer.applications.resources.Folder.rename\');\nExt.namespace(\'org.ametys.explorer.applications.resources.Folder.remove\');\n@@ -29,6 +30,50 @@\nExt.namespace(\'org.ametys.explorer.applications.resources.File.download\');\n/*------------------------------------------------------------------------*/\n/**\n+ * Create a new CMIS server\n+ * @param {String} parentID The parent folder id\n+ * @param {String} name The new folder name\n+ * @param {function} callback The call back function\n+ */\n+org.ametys.explorer.applications.resources.Folder.addCMIS = function (parentID, name, callback, paramCon)\n+{\n+    // Appel Ajax\n+    var params = {};\n+    params.id = parentID;\n+    params.name = name;\n+    params.renameIfExists = true;\n+    params.url = paramCon.url;\n+    params.user = paramCon.user;\n+    params.pwd = paramCon.pwd;\n+\n+    var serverMessage = new org.ametys.servercomm.ServerMessage(\'explorer\', \'/add-cmis-collection\',\n+            params,\n+            org.ametys.servercomm.ServerComm.PRIORITY_MAJOR,\n+            function (response, args) {\n+                org.ametys.explorer.applications.resources.Folder.addCMISCb (response, args, callback);\n+            },\n+            this,\n+            []);\n+    org.ametys.servercomm.ServerComm.getInstance().send(serverMessage);\n+}\n+org.ametys.explorer.applications.resources.Folder.addCMISCb = function (response, args, callback)\n+{\n+\tif (org.ametys.servercomm.ServerComm.handleBadResponse("<i18n:text i18n:key="PLUGINS_EXPLORER_FOLDER_HANDLE_ADD_ERROR"/>", response, "org.ametys.explorer.applications.resources.Folder.add"))\n+\t{\n+\t\treturn;\n+\t}\n+\n+\tvar id = response.selectSingleNode("ActionResult/id")[org.ametys.servercomm.ServerComm.xmlTextContent];\n+\tvar parentID = response.selectSingleNode("ActionResult/parentID")[org.ametys.servercomm.ServerComm.xmlTextContent];\n+\tvar name = response.selectSingleNode("ActionResult/name")[org.ametys.servercomm.ServerComm.xmlTextContent];\n+\n+    if (typeof callback == \'function\')\n+    {\n+        callback (parentID, id, name);\n+    }\n+}\n+/*------------------------------------------------------------------------*/\n+/**\n* Create a new folder\n* @param {String} parentID The parent folder id\n* @param {String} name The new folder name'),
 ('main/plugin-explorer/resources/js/org/ametys/explorer/applications/resources/toolbar/ToolbarActions.i18n.js',
  'main/plugin-explorer/resources/js/org/ametys/explorer/applications/resources/toolbar/ToolbarActions.i18n.js',
  'Index: main/plugin-explorer/resources/js/org/ametys/explorer/applications/resources/toolbar/ToolbarActions.i18n.js\n===================================================================\n--- main/plugin-explorer/resources/js/org/ametys/explorer/applications/resources/toolbar/ToolbarActions.i18n.js\n+++ main/plugin-explorer/resources/js/org/ametys/explorer/applications/resources/toolbar/ToolbarActions.i18n.js\n@@ -15,6 +15,7 @@\n*/\n\nExt.namespace(\'org.ametys.explorer.applications.resources.toolbar\');\n+Ext.namespace(\'org.ametys.explorer.applications.resources.toolbar.Folder.addCMIS\');\nExt.namespace(\'org.ametys.explorer.applications.resources.toolbar.Folder.add\');\nExt.namespace(\'org.ametys.explorer.applications.resources.toolbar.Folder.rename\');\nExt.namespace(\'org.ametys.explorer.applications.resources.toolbar.Folder.remove\');\n@@ -29,6 +30,105 @@\n\n\n/*------------------------------------------------------------------------*/\n+org.ametys.explorer.applications.resources.toolbar.Folder.addCMIS = function (application)\n+{\n+\t//DialogBox when adding nodes\n+\taddCMIS = new org.ametys.DialogBox ({\n+\n+\t\ttitle : \'<i18n:text i18n:key="PLUGINS_EXPLORER_FOLDER_ADD_CMIS_REP_TITLE"/>\',\n+\n+        id: \'addCMISRep\',\n+        cls: \'text-dialog\',\n+        layout: \'form\',\n+        labelWidth: 100,\n+\n+        width: 420,\n+        height: 180,\n+        autoScroll: false,\n+\n+        items: [\n+            new org.ametys.form.TextField ({\n+                fieldLabel : \'<i18n:text i18n:key="PLUGINS_EXPLORER_FOLDER_ADD_CMIS_REP_URL"/>\',\n+                 id: \'addCMIS-url\',\n+                 width: 200,\n+                allowBlank: true\n+            }),\n+            new org.ametys.form.TextField ({\n+                fieldLabel : \'<i18n:text i18n:key="PLUGINS_EXPLORER_FOLDER_ADD_CMIS_REP_USER"/>\',\n+                id: \'addCMIS-user\',\n+                 width: 200,\n+                allowBlank: true\n+            }),\n+            new org.ametys.form.PasswordField ({\n+                fieldLabel : \'<i18n:text i18n:key="PLUGINS_EXPLORER_FOLDER_ADD_CMIS_REP_PWD"/>\',\n+                id: \'addCMIS-password\',\n+                width: 200,\n+               allowBlank: true\n+           }),\n+        ],\n+        closeAction: \'destroy\',\n+        buttons : [{\n+            text : "OK",\n+            handler: _okAddCMISRep\n+        },{\n+            text : "CANCEL",\n+            handler: _cancelAddCMISRep\n+        }]\n+    });\n+\n+\tExt.getCmp(\'addCMISRep\').show();\n+\n+    function _okAddCMISRep(){\n+\n+        var urlCMIS = Ext.getCmp(\'addCMIS-url\');\n+        var userCMIS = Ext.getCmp(\'addCMIS-user\');\n+        var pwdCMIS = Ext.getCmp(\'addCMIS-password\');\n+        var url = urlCMIS.getValue();\n+        var user = userCMIS.getValue();\n+        var pwd = pwdCMIS.getValue();\n+\n+        if(url=="" || user=="" || pwd=="")\n+        {\n+            Ext.Msg.alert("<i18n:text i18n:key="PLUGINS_EXPLORER_FOLDER_ADD_CMIS_REP_ERROR_TITLE"/>",\n+            \t\t"<i18n:text i18n:key="PLUGINS_EXPLORER_FOLDER_ADD_CMIS_REP_ERROR_MESSAGE"/>");\n+        }\n+        else{\n+            var el = Ext.getCmp(\'addCMISRep\');\n+            el.destroy();\n+\n+            var paramCon = {};\n+            paramCon.url = url;\n+            paramCon.user = user;\n+            paramCon.pwd = pwd;\n+\n+            var node = application._explorer.getSelectedNode();\n+            if (node == null)\n+                 return;\n+\n+             // Le noeud parent = id JCR du dossier qui va porter l\'arborescence CMIS\n+             var parentID = node.id;\n+             org.ametys.explorer.applications.resources.Folder.addCMIS (parentID,\n+                 "<i18n:text i18n:key="PLUGINS_EXPLORER_FOLDER_HANDLE_ADD_NEWNAME"/>",\n+                 function (parentID, id, name) {\n+                     org.ametys.explorer.applications.resources.toolbar.Folder._addCMISCb (parentID, id, name, application)\n+                 },\n+                 paramCon\n+               );\n+        }\n+    }\n+\n+    function _cancelAddCMISRep(){\n+        var el = Ext.getCmp(\'addCMISRep\');\n+        el.destroy();\n+    }\n+}\n+org.ametys.explorer.applications.resources.toolbar.Folder._addCMISCb = function (parentID, id, name, application)\n+{\n+\t// Rafraichi le noeud parent\n+    application._explorer._refreshNode (parentID, application._explorer.renameNode, [id]);\n+}\n+\n+/*------------------------------------------------------------------------*/\norg.ametys.explorer.applications.resources.toolbar.Folder.add = function (application)\n{\nvar node = application._explorer.getSelectedNode();'),
 ('main/plugin-explorer/resources/js/org/ametys/explorer/applications/resources/ResourcesApplication.i18n.js',
  'main/plugin-explorer/resources/js/org/ametys/explorer/applications/resources/ResourcesApplication.i18n.js',
  'Index: main/plugin-explorer/resources/js/org/ametys/explorer/applications/resources/ResourcesApplication.i18n.js\n===================================================================\n--- main/plugin-explorer/resources/js/org/ametys/explorer/applications/resources/ResourcesApplication.i18n.js\n+++ main/plugin-explorer/resources/js/org/ametys/explorer/applications/resources/ResourcesApplication.i18n.js\n@@ -107,6 +107,17 @@\nthis._toolbar = new Ext.Toolbar ({\nregion: \'north\',\nitems : [{\n+\t\t\t\t     id: \'toolbar-btn-cmis-add\',\n+\t\t\t\t     icon: getPluginResourcesUrl (\'explorer\') + \'/img/resources/folder_new_32.png\',\n+\t\t\t\t     tooltip : "<i18n:text i18n:key="PLUGINS_EXPLORER_CMIS_ADD_DESCRIPTION"/>",\n+\t\t\t\t     scale: \'large\',\n+\t\t\t\t     application: this,\n+\t\t\t\t     handler: function () {\n+\t\t\t\t         org.ametys.explorer.applications.resources.toolbar.CMIS.add (this.application);\n+\t\t\t\t     },\n+\t\t\t\t     disabled: true\n+\t\t\t\t },\n+\t\t         {\nid: \'toolbar-btn-folder-add\',\nicon: getPluginResourcesUrl (\'explorer\') + \'/img/resources/folder_new_32.png\',\ntooltip : "<i18n:text i18n:key="PLUGINS_EXPLORER_FOLDER_ADD_DESCRIPTION"/>",\n@@ -225,20 +236,21 @@\nreturn this._toolbar;\n}\n\n-org.ametys.explorer.applications.resources.ResourcesApplication.prototype._updateToolbar = function (folder, files)\n+org.ametys.explorer.applications.resources.ResourcesApplication.prototype._updateToolbar = function (folder, files, isModifiable)\n{\nvar isRoot = this._explorer._tree.getRootNode().id == folder;\n\n-\tthis._toolbar.get(\'toolbar-btn-folder-add\').setDisabled (folder == null);\n-\tthis._toolbar.get(\'toolbar-btn-folder-rename\').setDisabled (isRoot || folder == null);\n-\tthis._toolbar.get(\'toolbar-btn-folder-delete\').setDisabled (isRoot || folder == null);\n-\tthis._toolbar.get(\'toolbar-btn-file-add\').setDisabled (folder == null);\n-\tthis._toolbar.get(\'toolbar-btn-file-rename\').setDisabled (files == null || files.length == 0);\n-\tthis._toolbar.get(\'toolbar-btn-file-delete\').setDisabled (files == null || files.length == 0);\n+\tthis._toolbar.get(\'toolbar-btn-cmis-add\').setDisabled (folder == null || isModifiable == \'false\');\n+\tthis._toolbar.get(\'toolbar-btn-folder-add\').setDisabled (folder == null || isModifiable == \'false\');\n+\tthis._toolbar.get(\'toolbar-btn-folder-rename\').setDisabled (isRoot || folder == null || isModifiable == \'false\');\n+\tthis._toolbar.get(\'toolbar-btn-folder-delete\').setDisabled (isRoot || folder == null || isModifiable == \'false\');\n+\tthis._toolbar.get(\'toolbar-btn-file-add\').setDisabled (folder == null || isModifiable == \'false\');\n+\tthis._toolbar.get(\'toolbar-btn-file-rename\').setDisabled (files == null || files.length == 0 || isModifiable == \'false\');\n+\tthis._toolbar.get(\'toolbar-btn-file-delete\').setDisabled (files == null || files.length == 0 || isModifiable == \'false\');\nthis._toolbar.get(\'toolbar-btn-file-download\').setDisabled (files == null || files.length == 0);\n-\tthis._toolbar.get(\'toolbar-btn-file-history\').setDisabled (files == null || files.length == 0);\n-\tthis._toolbar.get(\'toolbar-btn-file-cut\').setDisabled (files == null || files.length == 0);\n-\tthis._toolbar.get(\'toolbar-btn-file-paste\').setDisabled (folder == null);\n+\tthis._toolbar.get(\'toolbar-btn-file-history\').setDisabled (files == null || files.length == 0 || isModifiable == \'false\');\n+\tthis._toolbar.get(\'toolbar-btn-file-cut\').setDisabled (files == null || files.length == 0 || isModifiable == \'false\');\n+\tthis._toolbar.get(\'toolbar-btn-file-paste\').setDisabled (folder == null || isModifiable == \'false\');\n\n}\n\n@@ -331,7 +343,7 @@\nbreak;\n\ncase \'updateToolbar\':\n-\t\t\tthis._updateToolbar (params.id, params.files);\n+\t\t\tthis._updateToolbar (params.id, params.files, params.isModifiable);\nbreak;\ndefault:\nthrow "The command \'" + cmd + "\' is unknown";'),
 ('main/plugin-explorer/resources/js/org/ametys/explorer/tree/ResourcesXmlLoader.js',
  'main/plugin-explorer/resources/js/org/ametys/explorer/tree/ResourcesXmlLoader.js',
  'Index: main/plugin-explorer/resources/js/org/ametys/explorer/tree/ResourcesXmlLoader.js\n===================================================================\n--- main/plugin-explorer/resources/js/org/ametys/explorer/tree/ResourcesXmlLoader.js\n+++ main/plugin-explorer/resources/js/org/ametys/explorer/tree/ResourcesXmlLoader.js\n@@ -34,7 +34,7 @@\n* Override createNode function to always return a AsyncTreeNode\n*/\norg.ametys.explorer.tree.ResourcesXmlLoader.prototype.createNode = function(node)\n-{\n+{\nvar attr = {\ntagName :node.tagName\n};'),
 ('main/plugin-explorer/resources_nodetypes.xml',
  'main/plugin-explorer/resources_nodetypes.xml',
  'Index: main/plugin-explorer/resources_nodetypes.xml\n===================================================================\n--- main/plugin-explorer/resources_nodetypes.xml\n+++ main/plugin-explorer/resources_nodetypes.xml\n@@ -15,6 +15,15 @@\nlimitations under the License.\n-->\n<nodeTypes xmlns:nt="http://www.jcp.org/jcr/nt/1.0" xmlns:mix="http://www.jcp.org/jcr/mix/1.0" xmlns:ametys="http://www.ametys.org/jcr/repository/1.0">\n+    <nodeType name="ametys:cmis-root-collection" isMixin="false" hasOrderableChildNodes="false" primaryItemName="">\n+        <supertypes>\n+            <supertype>nt:folder</supertype>\n+            <supertype>ametys:object</supertype>\n+        </supertypes>\n+        <propertyDefinition name="ametys:url" requiredType="String" autoCreated="false" mandatory="true" onParentVersion="COPY" protected="false" multiple="false"/>\n+        <propertyDefinition name="ametys:user" requiredType="String" autoCreated="false" mandatory="false" onParentVersion="COPY" protected="false" multiple="false"/>\n+        <propertyDefinition name="ametys:password" requiredType="String" autoCreated="false" mandatory="false" onParentVersion="COPY" protected="false" multiple="false"/>\n+    </nodeType>\n<nodeType name="ametys:resources-collection" isMixin="false" hasOrderableChildNodes="false" primaryItemName="">\n<supertypes>\n<supertype>nt:folder</supertype>')]