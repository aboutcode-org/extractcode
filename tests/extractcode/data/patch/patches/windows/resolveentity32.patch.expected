[('Documents and Settings/Alex Burgel/workspace/Hibernate3.2/test/org/hibernate/test/AllTests.java',
  'Documents and Settings/Alex Burgel/workspace/Hibernate3.2/test/org/hibernate/test/AllTests.java',
  'Index: C:/Documents and Settings/Alex Burgel/workspace/Hibernate3.2/test/org/hibernate/test/AllTests.java\n===================================================================\n--- Documents and Settings/Alex Burgel/workspace/Hibernate3.2/test/org/hibernate/test/AllTests.java\n+++ Documents and Settings/Alex Burgel/workspace/Hibernate3.2/test/org/hibernate/test/AllTests.java\n@@ -88,6 +88,7 @@\nimport org.hibernate.test.mapping.ValueVisitorTest;\nimport org.hibernate.test.mappingexception.MappingExceptionTest;\nimport org.hibernate.test.mixed.MixedTest;\n+import org.hibernate.test.naturalid.EntityNaturalIdTest;\nimport org.hibernate.test.naturalid.NaturalIdTest;\nimport org.hibernate.test.ondelete.OnDeleteTest;\nimport org.hibernate.test.onetomany.OneToManyTest;\n@@ -176,6 +177,7 @@\nsuite.addTest( SaveOrUpdateTest.suite() );\nsuite.addTest( MergeTest.suite() );\nsuite.addTest( NaturalIdTest.suite() );\n+\t\t\tsuite.addTest( EntityNaturalIdTest.suite() );\nsuite.addTest( ComponentTest.suite() );\nsuite.addTest( ProxyTest.suite() );\nsuite.addTest( VersionTest.suite() );'),
 ('Documents and Settings/Alex Burgel/workspace/Hibernate3.2/test/org/hibernate/test/naturalid/EntityNaturalIdTest.java',
  'Documents and Settings/Alex Burgel/workspace/Hibernate3.2/test/org/hibernate/test/naturalid/EntityNaturalIdTest.java',
  'Index: C:/Documents and Settings/Alex Burgel/workspace/Hibernate3.2/test/org/hibernate/test/naturalid/EntityNaturalIdTest.java\n===================================================================\n--- Documents and Settings/Alex Burgel/workspace/Hibernate3.2/test/org/hibernate/test/naturalid/EntityNaturalIdTest.java\n+++ Documents and Settings/Alex Burgel/workspace/Hibernate3.2/test/org/hibernate/test/naturalid/EntityNaturalIdTest.java\n@@ -0,0 +1,105 @@\n+package org.hibernate.test.naturalid;\n+\n+import java.lang.reflect.Field;\n+\n+import junit.framework.Test;\n+import junit.framework.TestSuite;\n+\n+import org.hibernate.FetchMode;\n+import org.hibernate.HibernateException;\n+import org.hibernate.Session;\n+import org.hibernate.Transaction;\n+import org.hibernate.cfg.Configuration;\n+import org.hibernate.cfg.Environment;\n+import org.hibernate.criterion.Restrictions;\n+import org.hibernate.test.TestCase;\n+\n+/**\n+ * @author Alex Burgel\n+ */\n+public class EntityNaturalIdTest extends TestCase {\n+\n+    public EntityNaturalIdTest(String str) {\n+        super(str);\n+    }\n+\n+    public void testNaturalIdCheck() throws Exception {\n+        Session s = openSession();\n+        Transaction t = s.beginTransaction();\n+\n+        Parent p = new Parent("alex");\n+        Child c = new Child("billy", p);\n+\n+        s.persist(p);\n+        s.persist(c);\n+        Field name = c.getClass().getDeclaredField("name");\n+        name.setAccessible(true);\n+        name.set(c, "phil");\n+        try {\n+            s.flush();\n+            fail();\n+        }\n+        catch (HibernateException he) {}\n+        name.set(c, "billy");\n+        s.delete(c);\n+        s.delete(p);\n+        t.commit();\n+        s.close();\n+    }\n+\n+    public void testSaveParentWithDetachedChildren() throws Exception {\n+        Session s = openSession();\n+        Transaction t = s.beginTransaction();\n+\n+        Parent p = new Parent("alex");\n+        Child c = new Child("billy", p);\n+\n+        s.persist(p);\n+        s.persist(c);\n+        t.commit();\n+        s.close();\n+\n+        s = openSession();\n+        t = s.beginTransaction();\n+\n+        p = (Parent) s.createCriteria(Parent.class)\n+        .add( Restrictions.eq("name", "alex") )\n+        .setFetchMode("children", FetchMode.JOIN)\n+        .setCacheable(true)\n+        .uniqueResult();\n+\n+        t.commit();\n+        s.close();\n+\n+        s = openSession();\n+        t = s.beginTransaction();\n+\n+        Child c2 = new Child("joey", p);\n+        p.getChildren().add(c2);\n+\n+        s.update(p);\n+\n+        // this fails if AbstractEntityPersister returns identifiers instead of entities from\n+        // AbstractEntityPersister.getNaturalIdSnapshot()\n+        s.flush();\n+\n+        s.delete(p);\n+        t.commit();\n+        s.close();\n+    }\n+\n+    protected void configure(Configuration cfg) {\n+        cfg.setProperty(Environment.USE_SECOND_LEVEL_CACHE, "true");\n+        cfg.setProperty(Environment.USE_QUERY_CACHE, "true");\n+        cfg.setProperty(Environment.GENERATE_STATISTICS, "true");\n+    }\n+\n+    protected String[] getMappings() {\n+        return new String[] { "naturalid/Parent.hbm.xml" };\n+    }\n+\n+    public static Test suite() {\n+        return new TestSuite(EntityNaturalIdTest.class);\n+    }\n+\n+}'),
 ('Documents and Settings/Alex Burgel/workspace/Hibernate3.2/test/org/hibernate/test/naturalid/Child.java',
  'Documents and Settings/Alex Burgel/workspace/Hibernate3.2/test/org/hibernate/test/naturalid/Child.java',
  'Index: C:/Documents and Settings/Alex Burgel/workspace/Hibernate3.2/test/org/hibernate/test/naturalid/Child.java\n===================================================================\n--- Documents and Settings/Alex Burgel/workspace/Hibernate3.2/test/org/hibernate/test/naturalid/Child.java\n+++ Documents and Settings/Alex Burgel/workspace/Hibernate3.2/test/org/hibernate/test/naturalid/Child.java\n@@ -0,0 +1,20 @@\n+//$Id$\n+package org.hibernate.test.naturalid;\n+\n+/**\n+ * @author Alex Burgel\n+ */\n+public class Child {\n+\n+\tprivate Long id;\n+    private Parent parent;\n+\tprivate String name;\n+\n+\tChild() {}\n+\n+\tpublic Child(String name, Parent parent) {\n+\t\tthis.name = name;\n+        this.parent = parent;\n+\t}\n+\n+}'),
 ('Documents and Settings/Alex Burgel/workspace/Hibernate3.2/test/org/hibernate/test/naturalid/Parent.java',
  'Documents and Settings/Alex Burgel/workspace/Hibernate3.2/test/org/hibernate/test/naturalid/Parent.java',
  'Index: C:/Documents and Settings/Alex Burgel/workspace/Hibernate3.2/test/org/hibernate/test/naturalid/Parent.java\n===================================================================\n--- Documents and Settings/Alex Burgel/workspace/Hibernate3.2/test/org/hibernate/test/naturalid/Parent.java\n+++ Documents and Settings/Alex Burgel/workspace/Hibernate3.2/test/org/hibernate/test/naturalid/Parent.java\n@@ -0,0 +1,35 @@\n+//$Id$\n+package org.hibernate.test.naturalid;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+/**\n+ * @author Alex Burgel\n+ */\n+public class Parent {\n+\n+\tprivate Long id;\n+\tprivate String name;\n+\tprivate List children = new ArrayList();\n+\n+\tParent() {}\n+\n+\tpublic Parent(String name) {\n+\t\tthis.name = name;\n+\t}\n+\n+    public void setName(String name) {\n+        this.name = name;\n+    }\n+\n+    public List getChildren() {\n+        return children;\n+    }\n+\n+    public void setChildren(List children) {\n+        this.children = children;\n+    }\n+\n+\n+}'),
 ('Documents and Settings/Alex Burgel/workspace/Hibernate3.2/test/org/hibernate/test/naturalid/Parent.hbm.xml',
  'Documents and Settings/Alex Burgel/workspace/Hibernate3.2/test/org/hibernate/test/naturalid/Parent.hbm.xml',
  'Index: C:/Documents and Settings/Alex Burgel/workspace/Hibernate3.2/test/org/hibernate/test/naturalid/Parent.hbm.xml\n===================================================================\n--- Documents and Settings/Alex Burgel/workspace/Hibernate3.2/test/org/hibernate/test/naturalid/Parent.hbm.xml\n+++ Documents and Settings/Alex Burgel/workspace/Hibernate3.2/test/org/hibernate/test/naturalid/Parent.hbm.xml\n@@ -0,0 +1,41 @@\n+<?xml version="1.0"?>\n+<!DOCTYPE hibernate-mapping PUBLIC\n+\t"-//Hibernate/Hibernate Mapping DTD 3.0//EN"\n+\t"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">\n+\n+<!--\n+\n+  This mapping illustrates use of <natural-id> with a many-to-one.\n+\n+-->\n+\n+<hibernate-mapping\n+\tpackage="org.hibernate.test.naturalid"\n+\tdefault-access="field">\n+\n+\t<class name="Parent" table="Parent">\n+\t\t<id name="id">\n+\t\t\t<generator class="increment"/>\n+\t\t</id>\n+\n+\t\t<property name="name"/>\n+\n+\t\t<bag name="children" inverse="true" cascade="all">\n+\t\t\t<key column="parent" />\n+\t\t\t<one-to-many class="Child" />\n+\t\t</bag>\n+\n+\t</class>\n+\n+\t<class name="Child" table="Child">\n+\t\t<id name="id">\n+\t\t\t<generator class="increment"/>\n+\t\t</id>\n+\n+\t\t<natural-id>\n+\t\t\t<many-to-one name="parent" class="Parent" />\n+\t\t\t<property name="name"/>\n+\t\t</natural-id>\n+\t</class>\n+\n+</hibernate-mapping>'),
 ('Documents and Settings/Alex Burgel/workspace/Hibernate3.2/src/org/hibernate/persister/entity/AbstractEntityPersister.java',
  'Documents and Settings/Alex Burgel/workspace/Hibernate3.2/src/org/hibernate/persister/entity/AbstractEntityPersister.java',
  '\\ No newline at end of file\nIndex: C:/Documents and Settings/Alex Burgel/workspace/Hibernate3.2/src/org/hibernate/persister/entity/AbstractEntityPersister.java\n===================================================================\n--- Documents and Settings/Alex Burgel/workspace/Hibernate3.2/src/org/hibernate/persister/entity/AbstractEntityPersister.java\n+++ Documents and Settings/Alex Burgel/workspace/Hibernate3.2/src/org/hibernate/persister/entity/AbstractEntityPersister.java\n@@ -3732,6 +3732,9 @@\n\nfor ( int i = 0; i < naturalIdPropertyCount; i++ ) {\nsnapshot[i] = extractionTypes[i].hydrate( rs, getPropertyAliases( "", naturalIdPropertyIndexes[i] ), session, null );\n+\t\t\t\t\t\tif (extractionTypes[i].isEntityType()) {\n+\t\t\t\t\t\t\tsnapshot[i] = extractionTypes[i].resolve(snapshot[i], session, null);\n+\t\t\t\t\t\t}\n}\nreturn snapshot;\n}')]